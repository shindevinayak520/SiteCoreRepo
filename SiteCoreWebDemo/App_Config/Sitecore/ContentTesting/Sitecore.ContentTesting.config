<?xml version="1.0" encoding="utf-8"?>

<!--

Purpose: This include file enables and configures the content testing features of Sitecore.

-->
<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/" xmlns:role="http://www.sitecore.net/xmlconfig/role/">
  <sitecore role:require="Standalone or ContentManagement or ContentDelivery or Reporting or Processing">
    <settings>
      <!-- CONTENT TESTING - AUTOMATIC CONTENT TESTING - ENABLED
           Determines whether automatic content testing features should be enabled.
           Default value: true
      -->
      <setting name="ContentTesting.AutomaticContentTesting.Enabled" value="true" />

      <!-- CONTENT TESTING - ALWAYS SHOW TEST CANDIDATE NOTIFICATION
           Determines whether show test candidate notification is always enabled in the Content Testing.
           Default value: true
      -->
      <setting name="ContentTesting.AlwaysShowTestCandidateNotification" value="true" />

      <!-- CONTENT TESTING - COMMAND ROUTE PREFIX
           The prefix used for controller routes.
           Default value: sitecore/shell/api/ct/
      -->
      <setting name="ContentTesting.CommandRoutePrefix" value="sitecore/shell/api/ct/" />

      <!-- CONTENT TESTING - COMMAND ROUTE PREFIX MVC
           The prefix used for controller routes for mvc controllers.
           Default value: sitecore/shell/api/ct/mvc
      -->
      <setting name="ContentTesting.CommandRoutePrefix.Mvc" value="sitecore/shell/ct/" />

      <!-- CONTENT TESTING - CUSTOM PATH FOR GENERATED FILES
           The path used for modifying the default path for generated files. 
           Default value: /temp
      -->
      <setting name="ContentTesting.CustomFileGenerationPath" value="/temp" />

      <!-- CONTENT TESTING - DEFAULT CONFIDENCE LEVEL           
           The confidence level used when creating new content tests.
           Default value: 95
      -->
      <setting name="ContentTesting.DefaultConfidenceLevel" value="95" />

      <!-- CONTENT TESTING - DEFAULT TRAFFIC ALLOCATION
           The content test traffic allocation as a percentage.
           Default value: 100
      -->
      <setting name="ContentTesting.DefaultTrafficAllocation" value="100" />

      <!-- CONTENT TESTING - END TEST RULESET
           The path to the ruleset that determines whether a test can finish automatically.
           Default value: /sitecore/system/Settings/Content Testing/End Test Behavior
      -->
      <setting name="ContentTesting.EndTestRuleset" value="/sitecore/system/Settings/Content Testing/End Test Behavior" />

      <!-- CONTENT TESTING - GENERATE SCREENSHOTS 
           Determines when screenshots should be generated.
           Must be one of ( all | limited | none )
           Default value: all
      -->
      <setting name="ContentTesting.GenerateScreenshots" value="all" />

      <!-- CONTENT TESTING - MAXIMUM CONTENT TEST DURATION
           The maximum duration in days of a content test.
           
           Default value: 14
      -->
      <setting name="ContentTesting.MaximumContentTestDuration" value="14" />

      <!-- CONTENT TESTING - MAXIMUM MV TEST DURATION
           The maximum duration in days of a multivariate content test.
           Default value: 90
      -->
      <setting name="ContentTesting.MaximumOptimizationTestDuration" value="90" />

      <!-- CONTENT TESTING - MAXIMUM TOP EXPERIENCES
           Determines the upper limit for experiences if experiences is more than 1000. 
           Default value: 100
      -->
      <setting name="ContentTesting.MaximumTopExperience" value="100" />

      <!-- CONTENT TESTING - MINIMUM DURATION
           The minimum duration in days of a content test.
           Default value: 7
      -->
      <setting name="ContentTesting.MinimumDuration" value="7" />

      <!--  PAGE DAILY VISITS CACHE EXPIRATION
            Sets the absolute expiration on the cached daily visits data in Experience Editor.
            Makes sense only when analytics is enabled.            
            Default value: 1.00:00:00 (1 day)
      -->
      <setting name="ContentTesting.PageDailyVisitsCacheExpiration" value="1.00:00:00" />

      <!--  TEST STATISTICS CACHE EXPIRATION
            Sets the absolute expiration on the cached test statistics data in Experience Editor.
            Makes sense only when analytics is enabled.            
            Default value: 01:00:00 (1 hour)
        -->
      <setting name="ContentTesting.TestStatisticsCacheExpiration" value="01:00:00" />

      <!-- CONTENT TESTING - PERSONALIZATION INDEX NAME
           The default personalization index name.
           Default value: sitecore_personalization_index
      -->
      <setting name="ContentTesting.PersonalizationIndexName" value="sitecore_personalization_index" />

      <!-- CONTENT TESTING - PHANTOM JS - REMOVE ABANDONED JS FILES
           Determines whether should remove abandoned JavaScript files.
           Default value: false
      -->
      <setting name="ContentTesting.PhantomJS.RemoveAbandonedJS" value="false" />

      <!-- CONTENT TESTING - PHANTOM JS - ENABLE DISK CACHE
           Determines whether the PhantomJS tool should use disk caching for web resources.
           Default value: true
      -->
      <setting name="ContentTesting.PhantomJS.EnableDiskCache" value="true" />

      <!-- CONTENT TESTING - PHANTOM JS - ENABLE JAVASCRIPT
           Determines whether the PhantomJS tool should allow JavaScript on pages.
           Default value: true
      -->
      <setting name="ContentTesting.PhantomJS.EnableJavaScript" value="true" />

      <!-- CONTENT TESTING - PHANTOM JS - EXECUTABLE PATH
           The path to the PhantomJS tool that is used to generate screenshots of pages.
           Default value: $(dataFolder)/tools/phantomjs/phantomjs.exe
      -->
      <setting name="ContentTesting.PhantomJS.ExecutablePath" value="$(dataFolder)/tools/phantomjs/phantomjs.exe" />

      <!-- CONTENT TESTING - PHANTOM JS - IGNORE SSL ERRORS
           Determines whether the PhantomJS tool should ignore errors with SSL when accessing resources.
           Default value: true
      -->
      <setting name="ContentTesting.PhantomJS.IgnoreSSLErrors" value="true" />

      <!-- CONTENT TESTING - PHANTOM JS - .JS FILE MAX TIMESPAN
           The maximum timespan an abandoned .js file can exist in minute.
           Default value: 5
      -->
      <setting name="ContentTesting.PhantomJS.JSFileMaxTimespan" value="5" />

      <!-- CONTENT TESTING - PHANTOM JS - LOAD IMAGES
           Determines whether the PhantomJS tool should load images on pages.
           Default value: true
      -->
      <setting name="ContentTesting.PhantomJS.LoadImages" value="true" />

      <!-- CONTENT TESTING - PHANTOM JS - LOCK NAVIGATION
           Determines whether the PhantomJS tool will load content from other URLs including iFrames.
           Default value: true
      -->
      <setting name="ContentTesting.PhantomJS.LockNavigation" value="true" />

      <!-- CONTENT TESTING - PHANTOM JS - SSL PROTOCOL
           The SSL protocol to instruct the PhantomJS tool to use for SSL resources.
           Must be one of ( SSLv3 | SSLv2 | TLSv1 | any )
           Default value: any
      -->
      <setting name="ContentTesting.PhantomJS.SSLProtocol" value="any" />

      <!-- CONTENT TESTING - PHANTOM JS - TIMEOUT
           The timeout in milliseconds used when executing calls to PhantomJS
           Default value: 60000
      -->
      <setting name="ContentTesting.PhantomJS.Timeout" value="60000" />

      <!--  CONTENT TESTING - DATABASE - REPORTING - NAME
            The reporting database name. Using to store Personalization rules.
            Default value: reporting
      -->
      <setting name="ContentTesting.Database.Reporting.Name" value="reporting" />

      <!-- CONTENT TESTING - SCREENSHOT - VIEWPORT - DEFAULT HEIGHT
           The height of the view port used to generate screenshots of pages if not specified in the screenshot task.
           Default value: 800
      -->
      <setting name="ContentTesting.Screenshot.ViewPort.DefaultHeight" value="800" />

      <!-- CONTENT TESTING - SCREENSHOT - VIEWPORT - DEFAULT WIDTH
           The width of the view port used to generate screenshots of pages if not specified in the screenshot task.
           Default value: 1200
      -->
      <setting name="ContentTesting.Screenshot.ViewPort.DefaultWidth" value="1200" />

      <!-- CONTENT TESTING - SUGGESTED TEST INDEX NAME
           The default suggested test index name.
           Default value: sitecore_suggested_test_index
      -->
      <setting name="ContentTesting.SuggestedTestIndexName" value="sitecore_suggested_test_index" />

      <!-- CONTENT TESTING - SUGGESTED TESTS - MAXIMUM
           The maximum number of suggested tests to show.
           Default value: 50
      -->
      <setting name="ContentTesting.SuggestedTests.Maximum" value="50" />

      <!-- CONTENT TESTING - TEST EXTENSION PERIOD
           The number of days that the test can be extended when no winner is found.
           Default value: 14
      -->
      <setting name="ContentTesting.TestExtensionPeriod" value="14" />

      <!-- CONTENT TESTING - TEST STRATEGY
           The default content test strategy.
           Default value: /sitecore/system/Settings/Content Testing/Test Strategies/Subgroup Round Robin Sticky
      -->
      <setting name="ContentTesting.TestStrategy" value="/sitecore/system/Settings/Content Testing/Test Strategies/Subgroup Round Robin Sticky" />

      <!-- CONTENT TESTING - TESTING INDEX NAME
           The default testing index name.
           Default value: sitecore_testing_index
      -->
      <setting name="ContentTesting.TestingIndexName" value="sitecore_testing_index" />

      <!-- CONTENT TESTING - VISITOR - COMBINATION STORAGE
           Specifies the storage mechanism to use for the visitors test combinations.
           Must be one of ( xdbfacet | cookie )
           Default value: xdbfacet
      -->
      <setting name="ContentTesting.Visitor.TestCombinationStorage" value="xdbfacet" />

      <!-- CONTENT TESTING - INTERACTION DDATA SOURCE - MAX BATCH SIZE
           The number of interaction data source max batch size for machine learning data projection usage.
           Default value: 1000
      -->
      <setting name="ContentTesting.ML.InteractionDataSource.MaxBatchSize" value="1000" />

      <!-- CONTENT TESTING - INTERACTION DATA SOURCE - DEFAULT SPLIT ITEM COUNT
           The number of interaction data source default split item count for machine learning data projection usage.
           Default value: 1000
      -->
      <setting name="ContentTesting.ML.InteractionDataSource.DefaultSplitItemCount" value="1000" />

      <!-- CONTENT TESTING - MODEL TRAINING - MAX DURATION
           The maximum allowed duration in minutes of a machine learning model training.
           Default value: 20
      -->
      <setting name="ContentTesting.ML.ModelTraining.MaxDuration" value="20" />

      <!-- CONTENT TESTING - MINIMUM UNIQUE VISITORS
           The minimum amount of unique visitors to start machine learning model training on each non-winning test experiences.
           Default value: 1000
      -->
      <setting name="ContentTesting.ML.MinimumUniqueVisitors" value="1000" />

      <!-- CONTENT TESTING - PUBLISHING TARGETS
           The publishing targets in comma separated Array which have published items.
           Default value: empty
      -->
      <setting name="ContentTesting.Publishing.Targets.List" value="" />

      <!--  SITENAME LIST CACHE EXPIRATION
            Sets the absolute expiration on the cached for reading list of sites from reporting DB.
            Default value: 00.00:05:00 (5 Minutes)
      -->
      <setting name="ContentTesting.SiteNameList.CacheExpiration" value="00.00:05:00" />

      <!--  PERSONALZIATION DASHBOARD CACHE EXPIRATION
            Sets the absolute expiration on the cached for reading personalization performance information from reporting DB.
            Default value: 00.00:05:00 (5 Minutes)
      -->
      <setting name="ContentTesting.Personalization.Dashboard.CacheExpiration" value="00.00:05:00" />
      
      <!-- CONTENT TESTING - TRAFFIC ALLOCATION FOR PERSONALIZATION EFFECT TRACKING
           The personalization effect tracking traffic allocation in percentage. 
           Default value: 10
      -->
      <setting name="ContentTesting.PersonalizationEffectTracking.TrafficAllocation" value="10" />


      <!--  PERSONALZIATION DASHBOARD CACHE SIZE
            Sets the absolute cache size for reading personalization performance information from reporting DB.
            Default value: 10MB
      -->
      <setting name="ContentTesting.Personalization.Dashboard.MaxCacheSize" value="10MB" />

    </settings>

    <!-- API -->
    <api>
      <services>
        <configuration type="Sitecore.Services.Infrastructure.Configuration.ServicesConfiguration, Sitecore.Services.Infrastructure">
          <allowedControllers hint="list:AddController">
            <allowedController desc="CT_ActivityController">Sitecore.ContentTesting.Requests.Controllers.Optimization.ActivityController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_DateController">Sitecore.ContentTesting.Requests.Controllers.Optimization.DateController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_ItemInfoController">Sitecore.ContentTesting.Requests.Controllers.Optimization.ItemInfoController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestOutcomesController">Sitecore.ContentTesting.Requests.Controllers.Optimization.TestOutcomesController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestsController">Sitecore.ContentTesting.Requests.Controllers.Optimization.TestsController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_PersonalizationController">Sitecore.ContentTesting.Requests.Controllers.Personalization.PersonalizationController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_ReportingDashboardController">Sitecore.ContentTesting.Requests.Controllers.Personalization.ReportingDashboardController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_ActionController">Sitecore.ContentTesting.Requests.Controllers.TestResults.ActionController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_VisitsController">Sitecore.ContentTesting.Requests.Controllers.TestResults.VisitsController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestDefinitionController">Sitecore.ContentTesting.Requests.Controllers.TestResults.TestDefinitionController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TopClicksToPagesController">Sitecore.ContentTesting.Requests.Controllers.TestResults.TopClicksToPagesController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TopGoalsController">Sitecore.ContentTesting.Requests.Controllers.TestResults.TopGoalsController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestSummaryController">Sitecore.ContentTesting.Requests.Controllers.TestSummary.TestSummaryController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_ContentTestingController">Sitecore.ContentTesting.Requests.Controllers.ContentTestingController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_CreateTestDialogController">Sitecore.ContentTesting.Requests.Controllers.CreateTestDialogController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_OptionsMapperController">Sitecore.ContentTesting.Requests.Controllers.OptionsMapperController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_QueryController">Sitecore.ContentTesting.Requests.Controllers.QueryController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestObjectivesController">Sitecore.ContentTesting.Requests.Controllers.TestObjectivesController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestResultsController">Sitecore.ContentTesting.Requests.Controllers.TestResultsController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestThumbnailsController">Sitecore.ContentTesting.Requests.Controllers.TestThumbnailsController, Sitecore.ContentTesting</allowedController>
            <allowedController desc="CT_TestVariablesController">Sitecore.ContentTesting.Requests.Controllers.TestVariablesController, Sitecore.ContentTesting</allowedController>
          </allowedControllers>
        </configuration>
      </services>
    </api>

    <commands>
      <command name="optimization:componentperformance" type="Sitecore.ContentTesting.Commands.ComponentPerformance, Sitecore.ContentTesting" />
      <command name="test:createTest" type="Sitecore.ContentTesting.Commands.CreateTest, Sitecore.ContentTesting" />
    </commands>

    <!-- Content Testing Factory configuration
         The types listed here are used by the ContentTestingFactory. Override these settings to override the individual factories.
    -->
    <contentTesting>
      <!-- Concrete implementation types -->
      <contentTestingFactory type="Sitecore.ContentTesting.ContentTestingFactory, Sitecore.ContentTesting" />

      <!-- Content Test Performance Factory implementation type-->
      <contentTestPerformanceFactory type="Sitecore.ContentTesting.Reports.ContentTestPerformanceFactory, Sitecore.ContentTesting" />

      <!-- Content Test Store implementation type -->
      <contentTestStore type="Sitecore.ContentTesting.Data.SitecoreContentTestStore, Sitecore.ContentTesting" />

      <dataSourceResolver type="Sitecore.ContentTesting.Data.DataSourceResolver, Sitecore.ContentTesting" />

      <editModeContext type="Sitecore.ContentTesting.Editing.EditModeContext, Sitecore.ContentTesting" />

      <experienceAssignor type="Sitecore.ContentTesting.ExperienceAssignor, Sitecore.ContentTesting" />

      <forceWinnerBehaviorFactory type="Sitecore.ContentTesting.Rules.ForceWinnerBehavior.ForcedWinnerBehaviorFactory, Sitecore.ContentTesting">
        <forceWinnerBehaviors hint="raw:AddBehaviorRaw">
          <new name="New" type="Sitecore.ContentTesting.Rules.ForceWinnerBehavior.ForceNewExperienceWinner, Sitecore.ContentTesting" />
          <original name="Original" type="Sitecore.ContentTesting.Rules.ForceWinnerBehavior.ForceOriginalExperienceWinner, Sitecore.ContentTesting" />
        </forceWinnerBehaviors>
      </forceWinnerBehaviorFactory>

      <personalizationTestStore type="Sitecore.ContentTesting.Data.SitecorePersonalizationTestStore, Sitecore.ContentTesting" />

      <personalizationTestStoreExtension type="Sitecore.ContentTesting.Data.SitecorePersonalizationTestStore, Sitecore.ContentTesting" />

      <personalizationTracker type="Sitecore.ContentTesting.Analytics.PersonalizationTracker, Sitecore.ContentTesting" />

      <personalizationService type="Sitecore.ContentTesting.Services.PersonalizationService, Sitecore.ContentTesting">
        <param desc="contentTestStore" ref="contentTesting/contentTestStore" />
        <param desc="personalizationConfiguration" ref="contentTesting/personalizationTestStore" />
        <param desc="personalizationTestStoreExtension" ref="contentTesting/personalizationTestStoreExtension" />
        <param desc="performanceFactory" ref="contentTesting/contentTestPerformanceFactory" />
        <param desc="testValueInspector" type="Sitecore.ContentTesting.Inspectors.TestValueInspector, Sitecore.ContentTesting" />
      </personalizationService>

      <screenshotContextFactory type="Sitecore.ContentTesting.Screenshot.ScreenshotContextFactory, Sitecore.ContentTesting" />

      <screenshotGenerator type="Sitecore.ContentTesting.Screenshot.ScreenshotGenerator, Sitecore.ContentTesting" singleInstance="true" />

      <testCombinationContext type="Sitecore.ContentTesting.Web.TestCombinationContext, Sitecore.ContentTesting">
        <param desc="httpContext" />
      </testCombinationContext>

      <testingTracker type="Sitecore.ContentTesting.Analytics.TestingTracker, Sitecore.ContentTesting" />

      <testRunEstimator type="Sitecore.ContentTesting.Data.TestRunEstimator, Sitecore.ContentTesting" />

      <ruleTextProviderFactory type="Sitecore.ContentTesting.PersonalizationRules.RuleProviderFactory, Sitecore.ContentTesting">
        <rules hint="list:AddRule">

          <rule key="Country" type="Sitecore.ContentTesting.PersonalizationRules.Providers.InListRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{52E42C59-7210-43E5-94A6-3EA6B98835B8}</param>
            <param desc="attributeName">value</param>
            <root>/sitecore/system/Settings/Analytics/Lookups/Countries</root>
          </rule>

          <rule key="LandingPageId" type="Sitecore.ContentTesting.PersonalizationRules.Providers.InListRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{9BD1F746-B5DF-4FE3-A1F8-AF6DFB660333}</param>
            <param desc="attributeName">ItemIds</param>
          </rule>

          <rule key="DeviceType" type="Sitecore.ContentTesting.PersonalizationRules.Providers.InListRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{F563E8D0-1D8A-4744-BD90-3C8D7E483884}</param>
            <param desc="attributeName">Value</param>
            <root>/sitecore/system/Settings/Rules/Definitions/Elements/Device/Device Type/Device Types</root>
          </rule>

          <rule key="CampaignId" type="Sitecore.ContentTesting.PersonalizationRules.Providers.CampaignRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{0290AA90-B948-4C8C-B576-F3C17F9DE389}</param>
            <param desc="attributeName">CampaignsList</param>
          </rule>

          <rule key="ContactVisitIndex" type="Sitecore.ContentTesting.PersonalizationRules.Providers.CompareNumericRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{61370693-189D-44A0-ABC5-2592DBD579ED}</param>
            <param desc="attributeName">no</param>
          </rule>

          <rule key="Region" type="Sitecore.ContentTesting.PersonalizationRules.Providers.RegularExpressionRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{29FB46B8-32D3-49CC-877B-1512215EB39A}</param>
            <param desc="attributeName">value</param>
          </rule>

          <rule key="OperatingSystem" type="Sitecore.ContentTesting.PersonalizationRules.Providers.RegularExpressionRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{03E21995-D9B6-4AE6-8336-0C999CBE2838}</param>
            <param desc="attributeName">value</param>
          </rule>

          <rule key="Goal" type="Sitecore.ContentTesting.PersonalizationRules.Providers.EventRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{C1DA0D65-C9C7-4526-91BB-E0390A7D3833}</param>
            <param desc="attributeName">GoalId</param>
          </rule>

          <rule key="Event" type="Sitecore.ContentTesting.PersonalizationRules.Providers.EventRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{6F3DD3F4-52BF-410A-9DC8-60D83200DF3B}</param>
            <param desc="attributeName">PageEventId</param>
          </rule>

          <rule key="Outcome" type="Sitecore.ContentTesting.PersonalizationRules.Providers.EventRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{2C772C7C-E368-4553-893A-2A4CCFD32C36}</param>
            <param desc="attributeName">OutcomeId</param>
          </rule>

          <rule key="Profile" type="Sitecore.ContentTesting.PersonalizationRules.Providers.ProfileRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{08A70C4F-93B5-409E-9967-3892AAEB3BC2}</param>
            <param desc="attributeName">PatternList</param>
          </rule>

          <rule key="Default" type="Sitecore.ContentTesting.PersonalizationRules.Providers.DefaultRuleProvider, Sitecore.ContentTesting">
            <param desc="conditionId">{4888ABBB-F17D-4485-B14B-842413F88732}</param>
          </rule>

        </rules>
      </ruleTextProviderFactory>

    </contentTesting>

    <!-- Email templates used for test notifications -->
    <emailTemplateCreators>
      <template name="WinnerFound" type="Sitecore.ContentTesting.Notifications.Creators.WinnerFoundTemplateCreator, Sitecore.ContentTesting">
        <templateFile>/sitecore/shell/Applications/Notification/EmailTemplates/WinnerFound.html</templateFile>
      </template>
      <template name="NoWinner" type="Sitecore.ContentTesting.Notifications.Creators.NoWinnerTemplateCreator, Sitecore.ContentTesting">
        <templateFile>/sitecore/shell/Applications/Notification/EmailTemplates/NoWinner.html</templateFile>
      </template>
      <template name="Rollback" type="Sitecore.ContentTesting.Notifications.Creators.RollbackTemplateCreator, Sitecore.ContentTesting">
        <templateFile>/sitecore/shell/Applications/Notification/EmailTemplates/RollbackPrevious.html</templateFile>
      </template>
    </emailTemplateCreators>

    <!-- Behaviours used when forcing a test winner -->
    <forceWinnerBehaviors>
      <behavior name="New" type="Sitecore.ContentTesting.Rules.ForceWinnerBehavior.ForceNewExperienceWinner, Sitecore.ContentTesting" />
      <behavior name="Original" type="Sitecore.ContentTesting.Rules.ForceWinnerBehavior.ForceOriginalExperienceWinner, Sitecore.ContentTesting" />
    </forceWinnerBehaviors>

    <model>
      <elements>
        <element interface="Sitecore.ContentTesting.Model.Entities.ITestCombinationsData, Sitecore.ContentTesting.Model" implementation="Sitecore.ContentTesting.Model.Entities.TestCombinationsData, Sitecore.ContentTesting.Model" />
      </elements>
      <entities>
        <contact>
          <facets>
            <facet name="TestCombinations" contract="Sitecore.ContentTesting.Model.Entities.ITestCombinationsData, Sitecore.ContentTesting.Model" />
          </facets>
        </contact>
      </entities>
    </model>

    <events>
      <event name="item:saved">
        <handler type="Sitecore.ContentTesting.Events.PersonalizationTrackingHandler, Sitecore.ContentTesting" method="OnItemSaved" role:require="Standalone or ContentManagement">
          <includeFields hint="list:IncludeFieldInComparison">
            <renderings>__Renderings</renderings>
            <finalrenderings>__Final Renderings</finalrenderings>
          </includeFields>
        </handler>
      </event>
    </events>

    <pipelines>
      <!-- ADD PERSONALIZATION VARIABLES
           Loads and filters the personalization test variables in the test set
      -->
      <addPersonalizationVariables>
        <processor type="Sitecore.ContentTesting.Pipelines.AddPersonalizationVariables.FilterRules, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.AddPersonalizationVariables.AddRules, Sitecore.ContentTesting" />
      </addPersonalizationVariables>

      <!-- ADD SUGGESTED PERSONALIZATION
           Apply suggested personalization to item
      -->
      <AddSuggestedPersonalizations>
        <processor type="Sitecore.ContentTesting.Pipelines.AddSuggestedPersonalizations.AddVersion, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.AddSuggestedPersonalizations.AddPersonalizationVariants, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.AddSuggestedPersonalizations.DeactivatePersonalizationRules, Sitecore.ContentTesting"/>
        <processor type="Sitecore.ContentTesting.Pipelines.AddSuggestedPersonalizations.OpenExperienceEditorWithOptimizationMode, Sitecore.ContentTesting" />
      </AddSuggestedPersonalizations>

      <!-- CALCULATE TEST SCORE
           Calculates the score for the test
      -->
      <calculateTestScore>
        <processor type="Sitecore.ContentTesting.Pipelines.CalculateTestScore.GetAveragePageViews, Sitecore.ContentTesting">
          <QueryDays>30</QueryDays>
        </processor>
        <processor type="Sitecore.ContentTesting.Pipelines.CalculateTestScore.CalculateBestEffect, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CalculateTestScore.CalculateTestScore, Sitecore.ContentTesting" />
      </calculateTestScore>

      <!-- CAN CANCEL TEST
           Determine if a test can be cancelled
      -->
      <canCancelTest>
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.IsAdmin, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.IsTestOwner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.HasRole, Sitecore.ContentTesting">
          <roles hint="list:AddRole">
            <role>sitecore\Analytics Advanced Testing</role>
          </roles>
        </processor>
      </canCancelTest>

      <!-- CANCEL TEST
           Cancels a test and reverts test candidates back to their original state
      -->
      <cancelTest>
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.CheckCanCancelTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.ProcessTestWorkflow, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.CreateHistoricalTestData, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.RevertContent, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.PublishHostItem, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CancelTest.RemoveDraftTestDefinition, Sitecore.ContentTesting" />
      </cancelTest>

      <!-- CAN STOP TEST
           Determine if a test can be stopped
      -->
      <canStopTest>
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.IsAdmin, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.IsTestOwner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.CanControlTest.HasRole, Sitecore.ContentTesting">
          <roles hint="list:AddRole">
            <role>sitecore\Analytics Advanced Testing</role>
          </roles>
        </processor>
      </canStopTest>

      <!-- DETERMINE TEST EXPOSURE
           Determine if a user should be exposed to a test
      -->
      <determineTestExposure>
        <processor type="Sitecore.ContentTesting.Pipelines.DetermineTestExposure.ModularTrafficAllocation, Sitecore.ContentTesting" />
      </determineTestExposure>

      <!-- DETERMINE TEST OWNER
           Identifies the user who owns a test
      -->
      <determineTestOwner>
        <processor type="Sitecore.ContentTesting.Pipelines.DetermineTestOwner.GetFromContext, Sitecore.ContentTesting" />
        <!-- Enable this processor if you want to determine test owner by the workflow states transition user.
             You just need to specify the transitional workflow states that are used as from workflow states and
             the order of the transition history. -->
        <!--<processor type="Sitecore.ContentTesting.Pipelines.DetermineTestOwner.GetFromWorkflowHistory, Sitecore.ContentTesting">
          <TransitionalWorkflowStates hint="list:AddTransitionalWorkflowState">
            <WorkflowState>/sitecore/system/Workflows/Sample Workflow/Draft</WorkflowState>
          </TransitionalWorkflowStates>
          <FirstTransition>true</FirstTransition>
        </processor>-->
        <!-- Enable this processor if you want to determine test owner by the [Updated By] field of the host item.-->
        <!--<processor type="Sitecore.ContentTesting.Pipelines.DetermineTestOwner.GetFromStatistics, Sitecore.ContentTesting" />-->
      </determineTestOwner>

      <!-- GENERATE VARIANT DESCRIPTION
           Generate a user friendly description for the variant in the experience.
      -->
      <generateVariantDescription>
        <processor type="Sitecore.ContentTesting.Pipelines.GenerateVariantDescription.GetPageVersionTestDescription, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GenerateVariantDescription.GetContentTestTestDescription, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GenerateVariantDescription.GetComponentTestDescription, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GenerateVariantDescription.GetPersonalizationTestDescription, Sitecore.ContentTesting" />
      </generateVariantDescription>

      <getChromeData>
        <processor type="Sitecore.ContentTesting.Pipelines.GetChromeData.GetRenderingTestVariations, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.GetChromeData.GetRenderingChromeData, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetChromeData.GetOptimizationRenderingChromeData, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.GetChromeData.GetRenderingChromeData, Sitecore.Kernel']" />
      </getChromeData>

      <getContentEditorWarnings>
        <processor type="Sitecore.ContentTesting.Pipelines.GetContentEditorWarnings.GetContentTestingWarnings, Sitecore.ContentTesting" />
      </getContentEditorWarnings>

      <!-- GET CURRENT TEST COMBINATION
           Returns a test combination to expose to the current visitor.
      -->
      <getCurrentTestCombination>
        <processor type="Sitecore.ContentTesting.Pipelines.GetCurrentTestCombination.GetLatestTestingItemVersion, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetCurrentTestCombination.LoadTestSet, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetCurrentTestCombination.GetTestStrategyCombination, Sitecore.ContentTesting" />
      </getCurrentTestCombination>

      <!-- GET DATASOURCE WARNINGS FOR TEST
           Inspect an item being used as a datsource in a test and raise issues that could prevent it from acting within the test
      -->
      <getDatasourceWarningsForTest>
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.Publishable, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.PublishingRestrictions, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.Workflow, Sitecore.ContentTesting">
          <InspectHostItem>false</InspectHostItem>
        </processor>
      </getDatasourceWarningsForTest>

      <!-- GET ITEM WARNINGS FOR TEST
           Inspect an item being added to a page version test and raise issues that could prevent it from acting within the test
      -->
      <getItemWarningsForTest>
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.Publishable, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.PublishingRestrictions, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.Workflow, Sitecore.ContentTesting">
          <InspectHostItem>true</InspectHostItem>
        </processor>
        <processor type="Sitecore.ContentTesting.Pipelines.GetItemWarningsForTest.Presentation, Sitecore.ContentTesting" />
      </getItemWarningsForTest>

      <!-- GET VERSIONED TEST CANDIDATES
           Inspect an item without workflow and identify test candidates for it
      -->
      <getNonVersionedTestCandidates>
        <!-- Inspect for component tests -->
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidates.GetComponentTestCandidiates, Sitecore.ContentTesting">
          <!-- The following exclude properties allow filtering potential test candidates -->
          <!--<excludeTemplates hint="list:ExcludeTemplate">
            <sampleItem>{76036F5E-CBCE-46D1-AF0A-4143F9B557AA}</sampleItem>
          </excludeTemplates>
          <excludeItems hint="list:ExcludeItem">
            <home>{110D559F-DEA5-42EA-9C1C-8A5DF7E70EF9}</home>
          </excludeItems>
          <excludeDevices hint="list:ExcludeDevice">
            <print>{46D2F427-4CE5-4E1F-BA10-EF3636F43534}</print>
          </excludeDevices>
          <excludeRenderingType hint="list:ExcludeRendering">
            <sampleRendering>{493B3A83-0FA7-4484-8FC9-4680991CF743}</sampleRendering>
          </excludeRenderingType>
          <excludeSpecificRendering hint="list:ExcludeRenderingUid">
            <sampleOnHome>{B343725A-3A93-446E-A9C8-3A2CBD3DB489}</sampleOnHome>
          </excludeSpecificRendering>-->
        </processor>
        <!-- Inspect for personalization rules -->
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidates.GetPersonalizationTestCandidates, Sitecore.ContentTesting">
          <!-- The following setting will disable this candidate type by default in the test creation dialog -->
          <!--<DisableByDefault>true</DisableByDefault>-->
          <!-- The following exclude properties allow filtering potential test candidates -->
          <!--<excludeTemplates hint="list:ExcludeTemplate">
            <sampleItem>{76036F5E-CBCE-46D1-AF0A-4143F9B557AA}</sampleItem>
          </excludeTemplates>
          <excludeItems hint="list:ExcludeItem">
            <home>{110D559F-DEA5-42EA-9C1C-8A5DF7E70EF9}</home>
          </excludeItems>
          <excludeDevices hint="list:ExcludeDevice">
            <print>{46D2F427-4CE5-4E1F-BA10-EF3636F43534}</print>
          </excludeDevices>
          <excludeRenderingType hint="list:ExcludeRendering">
            <sampleRendering>{493B3A83-0FA7-4484-8FC9-4680991CF743}</sampleRendering>
          </excludeRenderingType>
          <excludeSpecificRendering hint="list:ExcludeRenderingUid">
            <sampleOnHome>{B343725A-3A93-446E-A9C8-3A2CBD3DB489}</sampleOnHome>
          </excludeSpecificRendering>-->
        </processor>
      </getNonVersionedTestCandidates>

      <getRenderingRules>
        <processor type="Sitecore.ContentTesting.Pipelines.GetRenderingRules.FilterForEditing, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Analytics.Pipelines.GetRenderingRules.FilterForEditing, Sitecore.Analytics']" />
      </getRenderingRules>

      <!-- GET SCEENSHOT
           Generate and scale screenshots
      -->
      <getScreenshot>
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenshot.CheckDisabler, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenshot.GenerateFilename, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenshot.CheckCachedImage, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenshot.GenerateScreenshotFile, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenshot.ScaleImage, Sitecore.ContentTesting" />
      </getScreenshot>

      <!-- GET SCREEN SHOT FOR URL
           Generate a screenshot for a page
      -->
      <getScreenShotForURL>
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.CheckDisabler, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.GenerateFilename, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.CheckCachedImage, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.PopulateUrlParameters, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.LoadUrl, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.RenderScripts, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.WriteScriptToDisk, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.GenerateScreenShot, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetScreenShotForURL.DeleteScript, Sitecore.ContentTesting" />
      </getScreenShotForURL>

      <!-- GET TESTS
           Inspect an item and identify all tests for it
      -->
      <getTests>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTests.GetPageLevelTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTests.GetContentTests, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTests.GetComponentTests, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTests.GetPersonalizationTests, Sitecore.ContentTesting" />
      </getTests>

      <!-- GET TEST CANDIDATE VARIANT DESCRIPTION
           Generate a user friendly description for a test candidate variant
      -->
      <getTestCandidateVariantDescription>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidateVariantDescription.TestType, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidateVariantDescription.Path, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidateVariantDescription.Rendering, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidateVariantDescription.Rules, Sitecore.ContentTesting" />
      </getTestCandidateVariantDescription>

      <!-- GET TEST OBJECTIVES
           Locate options to list as objectives of a test
      -->
      <getTestObjectives>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestObjectives.GetDefaults, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestObjectives.GetGoals, Sitecore.ContentTesting" />
      </getTestObjectives>

      <!-- GET TEST TO RUN
           Inspect an item for a test to run
      -->
      <getTestToRun>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromCache, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromQueryString, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromFinalLayout, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromField, Sitecore.ContentTesting">
          <param desc="fieldId">{8546D6E6-0749-4591-90F3-CEC033D6E8D8}</param>
          <!-- Page Level Test Definition -->
        </processor>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromField, Sitecore.ContentTesting">
          <param desc="fieldId">{700F4AAD-AD3B-4058-8673-A0CEE765A1F7}</param>
          <!-- Content Test -->
        </processor>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.GetFromVisualization, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.EnsurePageTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.CheckDevice, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.EnsureCorrectLanguage, Sitecore.ContentTesting">
          <excludeFields hint="list:AddExcludeVariableTemplateId">
            <pageLevel>{AB86861A-6030-46C5-B394-E8F99E8B87DB}</pageLevel>
          </excludeFields>
        </processor>
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.AddTestToCollection, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestToRun.SetCache, Sitecore.ContentTesting" />
      </getTestToRun>

      <!-- GET VERSIONED TEST CANDIDATES
           Inspect an item with workflow and identify test candidates for it
      -->
      <getVersionedTestCandidates>
        <!-- Inspect for component tests -->
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidates.GetComponentTestCandidiates, Sitecore.ContentTesting">
          <!-- The following exclude properties allow filtering potential test candidates -->
          <!--<excludeTemplates hint="list:ExcludeTemplate">
            <sampleItem>{76036F5E-CBCE-46D1-AF0A-4143F9B557AA}</sampleItem>
          </excludeTemplates>
          <excludeItems hint="list:ExcludeItem">
            <home>{110D559F-DEA5-42EA-9C1C-8A5DF7E70EF9}</home>
          </excludeItems>
          <excludeDevices hint="list:ExcludeDevice">
            <print>{46D2F427-4CE5-4E1F-BA10-EF3636F43534}</print>
          </excludeDevices>
          <excludeRenderingType hint="list:ExcludeRendering">
            <sampleRendering>{493B3A83-0FA7-4484-8FC9-4680991CF743}</sampleRendering>
          </excludeRenderingType>
          <excludeSpecificRendering hint="list:ExcludeRenderingUid">
            <sampleOnHome>{B343725A-3A93-446E-A9C8-3A2CBD3DB489}</sampleOnHome>
          </excludeSpecificRendering>-->
        </processor>
        <!-- Inspect for personalization rules -->
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidates.GetPersonalizationTestCandidates, Sitecore.ContentTesting">
          <!-- The following setting will disable this candidate type by default in the test creation dialog -->
          <!--<DisableByDefault>true</DisableByDefault>-->
          <!-- The following exclude properties allow filtering potential test candidates -->
          <!--<excludeTemplates hint="list:ExcludeTemplate">
            <sampleItem>{76036F5E-CBCE-46D1-AF0A-4143F9B557AA}</sampleItem>
          </excludeTemplates>
          <excludeItems hint="list:ExcludeItem">
            <home>{110D559F-DEA5-42EA-9C1C-8A5DF7E70EF9}</home>
          </excludeItems>
          <excludeDevices hint="list:ExcludeDevice">
            <print>{46D2F427-4CE5-4E1F-BA10-EF3636F43534}</print>
          </excludeDevices>
          <excludeRenderingType hint="list:ExcludeRendering">
            <sampleRendering>{493B3A83-0FA7-4484-8FC9-4680991CF743}</sampleRendering>
          </excludeRenderingType>
          <excludeSpecificRendering hint="list:ExcludeRenderingUid">
            <sampleOnHome>{B343725A-3A93-446E-A9C8-3A2CBD3DB489}</sampleOnHome>
          </excludeSpecificRendering>-->
        </processor>
        <!-- Inspect for content change tests -->
        <processor type="Sitecore.ContentTesting.Pipelines.GetTestCandidates.GetPageVersionTestCandidates, Sitecore.ContentTesting">
          <IgnoreRuleChanges>True</IgnoreRuleChanges>
          <IgnoreComponentTestChanges>True</IgnoreComponentTestChanges>
          <excludeFields hint="list:ExcludeFieldFromComparison">
            <created>__created</created>
            <createdby>__created by</createdby>
            <updated>__updated</updated>
            <updatedby>__updated by</updatedby>
            <revision>__revision</revision>
            <sortorder>__sortorder</sortorder>
            <validfrom>__valid from</validfrom>
            <workflow>__workflow</workflow>
            <workflowstate>__workflow state</workflowstate>
            <lock>__lock</lock>
            <pageleveltestsetdefinition>__Page Level Test Set Definition</pageleveltestsetdefinition>
            <renderings>__Renderings</renderings>
            <finalrenderings>__Final Renderings</finalrenderings>
          </excludeFields>
        </processor>
      </getVersionedTestCandidates>

      <httpRequestBegin>
        <processor type="Sitecore.ContentTesting.Pipelines.HttpRequest.SetReadOnlySessionStateForScreenshot, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.HttpRequest.ItemResolver, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.HttpRequest.ForcedEditingTestCombination, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.HttpRequest.ItemResolver, Sitecore.Kernel']" />
      </httpRequestBegin>

      <initialize>
        <processor type="Sitecore.ContentTesting.Pipelines.Initialize.RegisterContentTestingCommandRoute, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Mvc.Pipelines.Loader.InitializeRoutes, Sitecore.Mvc']" />
        <processor type="Sitecore.ContentTesting.Pipelines.Initialize.RegisterWebApiRoutes, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Mvc.Pipelines.Loader.InitializeRoutes, Sitecore.Mvc']" />
      </initialize>

      <insertRenderings>
        <processor type="Sitecore.ContentTesting.Pipelines.InsertRenderings.GetLatestTestingItem, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.InsertRenderings.Processors.GetItem, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.InsertRenderings.Testing, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Pipelines.InsertRenderings.Processors.EvaluateConditions, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.InsertRenderings.PersonalizationExperienceResolver, Sitecore.ContentTesting" />
      </insertRenderings>

      <publishVersion>
        <processor type="Sitecore.ContentTesting.Pipelines.PublishVersion.PublishTestingVersions, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Publishing.Pipelines.PublishVersion.Processors.RemoveOtherVersions, Sitecore.Kernel']" />
      </publishVersion>

      <renderDeviceEditorRendering>
        <processor type="Sitecore.ContentTesting.Pipelines.RenderDeviceEditorRendering.ComponentTestIndicator, Sitecore.ContentTesting" />
      </renderDeviceEditorRendering>

      <renderField>
        <processor type="Sitecore.ContentTesting.Pipelines.RenderField.HighlightContentChange, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.RenderField.AddBeforeAndAfterValues, Sitecore.Kernel']" />
      </renderField>

      <renderLayout>
        <processor type="Sitecore.ContentTesting.Pipelines.RenderLayout.EvaluateTestExposure, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Pipelines.RenderLayout.InsertRenderings, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.RenderLayout.PageLevelTestItemResolver, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Pipelines.RenderLayout.InsertRenderings, Sitecore.Kernel']" />
        <processor type="Sitecore.ContentTesting.Pipelines.RenderLayout.ContentTestDataSourceResolver, Sitecore.ContentTesting" patch:before="processor[@type='Sitecore.Pipelines.RenderLayout.InsertRenderings, Sitecore.Kernel']" />
      </renderLayout>

      <renderLayoutGridRendering>
        <processor type="Sitecore.ContentTesting.Pipelines.RenderLayoutGridRendering.ComponentTestIndicator, Sitecore.ContentTesting" />
      </renderLayoutGridRendering>

      <renderingRuleEvaluated>
        <processor type="Sitecore.ContentTesting.Pipelines.RenderingRuleEvaluated.TestingRule, Sitecore.ContentTesting" />
      </renderingRuleEvaluated>

      <parseDataSource>
        <processor type="Sitecore.ContentTesting.Pipelines.ParseDataSource.GetDataSourceItemByDataUri, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Pipelines.ParseDataSource.GetDataSourceItemByIdOrPath, Sitecore.Kernel']" />
      </parseDataSource>

      <!-- REVERT CONTENT
           Remove a test from an item and revert content to its original state
      -->
      <revertContent>
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.IdentifyHostItem, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.AddVersionToHost, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.ContentTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.PageLevelTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.ComponentTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RevertContent.PersonalizationTest, Sitecore.ContentTesting" />
      </revertContent>

      <!-- SAVE TEST OUTCOME
           Process and save outcome data of the test
      -->
      <saveTestOutcome>
        <processor type="Sitecore.ContentTesting.Pipelines.SaveTestOutcome.AddSummaryNotification, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.SaveTestOutcome.GenerateTestOutcome, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.SaveTestOutcome.DetermineTestOwner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.SaveTestOutcome.WriteTestOutcome, Sitecore.ContentTesting" />
      </saveTestOutcome>

      <!-- SESSIOND END
           Performs cleanup on session end
      -->
      <sessionEnd>
        <processor type="Sitecore.ContentTesting.Pipelines.SessionEnd.CleanupPreservedWorkflowArgs, Sitecore.ContentTesting" />
      </sessionEnd>

      <speak.client.initialize.layout>
        <processor mode="on" type="Sitecore.ContentTesting.Pipelines.InitializeSpeakLayout.AuthorizeContentTestingAccess, Sitecore.ContentTesting" />
      </speak.client.initialize.layout>

      <!-- START PAGE TEST
           Starts the page test
      -->
      <startPageTest>
        <processor type="Sitecore.ContentTesting.Pipelines.StartPageTest.DeployPageTestDependencies, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartPageTest.DeployComponentTestDependencies, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartPageTest.ProtectTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartPageTest.DeployTest, Sitecore.ContentTesting" />
      </startPageTest>

      <!-- START TEST
           Starts a test
      -->
      <startTest>
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.SetTestSettings, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.EnsureTestCandidates, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.DisableTestElements, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.ResolveTestLanguage, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.DetermineTestOwner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.SetTestObjective, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.DetermineDeviceBound, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.CreateTestDefinition, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.ProtectTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StartTest.Deploy, Sitecore.ContentTesting" />
      </startTest>

      <!-- STOP TEST
           Stops the test
      -->
      <stopTest>
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.StoreWinnerCombination, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.ProcessTestWorkflow, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.CreatePageLevelWinnerVersion, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.EnsureValidWinner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.CreateHistoricalTestData, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.RemoveContentTests, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.SetupWinnerComponents, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.RemovePoorPerformingRules, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.PublishWinner, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.StopTest.RunModelTraining, Sitecore.ContentTesting" />
      </stopTest>

      <!-- SUGGEST TESTS
           Inspect an item and suggest tests which may be run against it
      -->
      <suggestTests>
        <processor type="Sitecore.ContentTesting.Pipelines.SuggestTests.HasNeverBeenTested, Sitecore.ContentTesting" />
      </suggestTests>

      <!-- SUSPEND TEST
           Suspend the test.
      -->
      <suspendTest>
        <processor type="Sitecore.ContentTesting.Pipelines.SuspendTest.ProcessTestWorkflow, Sitecore.ContentTesting" />
      </suspendTest>

      <!-- REGISTER MACHINE LEARNING WORKERS
           Register Machine Learning Workers into Processing Engine.
      -->
      <registerMLWorkers>
        <processor type="Sitecore.ContentTesting.Pipelines.RegisterMLWorkers.RegisterWorkers, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RegisterMLWorkers.StoreModelTrainingTaskId, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.RegisterMLWorkers.StoreModelTrainingTaskStatus, Sitecore.ContentTesting" />
      </registerMLWorkers>

      <!-- VALIDATE MODEL TRAINING REQUIREMENTS
           Validates whether the test fulfills the requirements to start machine learning model training.
      -->
      <validateModelTrainingRequirements>
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateModelTrainingRequirements.CheckComponentTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateModelTrainingRequirements.CheckRequiredVisitAmount, SItecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateModelTrainingRequirements.CheckMinimumUniqueVisits, SItecore.ContentTesting" />
      </validateModelTrainingRequirements>

      <!-- VALIDATE DATA SOURCE CONFIGURATION
           Validates whethr data source for specified Test Value Item is not corrupted.
      -->
      <validateDataSourceConfiguration>
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateDataSourceConfiguration.ValidateContentTestDataSource, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateDataSourceConfiguration.ValidatePageTestDataSource, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateDataSourceConfiguration.ValidateComponentTestDataSource, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateDataSourceConfiguration.ValidatePersonalizationTestDataSource, Sitecore.ContentTesting" />

      </validateDataSourceConfiguration>

      <!-- VALIDATE STOP ACTION
           Validates whether it's possible to stop the test.
      -->
      <validateStopAction>
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateStopAction.ValidateUserCanStopTest, Sitecore.ContentTesting" />
        <processor type="Sitecore.ContentTesting.Pipelines.ValidateStopAction.ValidatePageTestTemplate, SItecore.ContentTesting" />
      </validateStopAction>

      <speak.client.resolveScript>
        <processor type="Sitecore.Resources.Pipelines.ResolveScript.Controls, Sitecore.Speak.Client">
          <sources hint="raw:AddSource">
            <source folder="/sitecore/shell/client/Applications/ContentTesting" deep="true" category="contenttesting" pattern="*.js,*.css" />
            <source folder="/sitecore/shell/client/Sitecore/ContentTesting" deep="true" category="contenttesting" pattern="*.js,*.css" />
          </sources>
        </processor>
      </speak.client.resolveScript>

      <group name="itemProvider" groupName="itemProvider">
        <pipelines>
          <getItem>
            <processor type="Sitecore.ContentTesting.Pipelines.ItemProvider.GetItem.GetItemUnderTestProcessor, Sitecore.ContentTesting" />
          </getItem>
        </pipelines>
      </group>

      <group groupName="ExperienceEditor" name="ExperienceEditor">
        <pipelines>
          <getPageEditorNotifications>
            <processor type="Sitecore.ContentTesting.Pipelines.GetPageEditorNotifications.GetContentTestingNotifications, Sitecore.ContentTesting" />
          </getPageEditorNotifications>
        </pipelines>
      </group>

      <!-- CONVERT TO XCONNECT INTERACTION
           Convert to MVTestEvent
           Convert to PersonalizationEvent
      -->
      <convertToXConnectInteraction>
        <processor type="Sitecore.ContentTesting.Pipelines.ConvertToXConnectInteraction.ConvertMVTestEvent, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Analytics.XConnect.DataAccess.Pipelines.ConvertToXConnectInteractionPipeline.ConvertToXConnectInteractionProcessor, Sitecore.Analytics.XConnect']" />
        <processor type="Sitecore.ContentTesting.Pipelines.ConvertToXConnectInteraction.ConvertPersonalizationEvent, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Analytics.XConnect.DataAccess.Pipelines.ConvertToXConnectInteractionPipeline.ConvertToXConnectInteractionProcessor, Sitecore.Analytics.XConnect']" />
      </convertToXConnectInteraction>

      <convertFromXConnectContact>
        <processor type="Sitecore.ContentTesting.Pipelines.ConvertFromXConnectContact.ConvertTestCombinationsProcessor, Sitecore.ContentTesting" patch:after="processor[@type='Sitecore.Analytics.XConnect.DataAccess.Pipelines.ConvertFromXConnectContactPipeline.ConvertFromXConnectContactProcessor, Sitecore.Analytics.XConnect']" />
      </convertFromXConnectContact>
    </pipelines>

    <dataAdapterManager defaultProvider="xconnect">
      <providers>
        <add name="xconnect" type="Sitecore.Analytics.XConnect.DataAccess.XConnectDataAdapterProvider, Sitecore.Analytics.XConnect">
          <facets hint="raw:AddFacet">
            <facet facetKey="TestCombinations" desc="ContentTesting_TestCombinations" />
          </facets>
        </add>
      </providers>
    </dataAdapterManager>

    <processors>
      <uiDeleteItems>
        <processor mode="on" type="Sitecore.ContentTesting.Pipelines.DeleteItems.DeleteTestDefinitionItems,Sitecore.ContentTesting"
                   method="CheckActiveTests"
                   patch:before="processor[@method='UncloneItems']" />
      </uiDeleteItems>
    </processors>

    <scheduling>
      <agent type="Sitecore.Tasks.CleanupAgent" method="Run">
        <files hint="raw:AddCommand">
          <remove folder="$(tempFolder)/screenshots" pattern="*.*" maxAge="7.00:00:00" recursive="true" />
        </files>
      </agent>
    </scheduling>

    <sitecore.experienceeditor.speak.requests>
      <request name="Optimization.ItemVersions.Count" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ItemVersionsCountRequest, Sitecore.ContentTesting" />
      <request name="Optimization.ActiveTests.Count" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ActiveTestsCountRequest, Sitecore.ContentTesting" />
      <request name="Optimization.ActiveItemTests.Count" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ActiveItemTestsCountRequest, Sitecore.ContentTesting" />
      <request name="Optimization.ActiveItemTest" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ItemHasActiveTestRequest, Sitecore.ContentTesting" />
      <request name="Optimization.HistoricalTests.Count" type="Sitecore.ContentTesting.Requests.ExperienceEditor.HistoricalTestsCountRequest, Sitecore.ContentTesting" />
      <request name="Optimization.IsContentTestingEnabledRequest" type="Sitecore.ContentTesting.Requests.ExperienceEditor.IsContentTestingEnabledRequest, Sitecore.ContentTesting" />
      <request name="Optimization.SuggestedTests.Count" type="Sitecore.ContentTesting.Requests.ExperienceEditor.SuggestedTestsCountRequest, Sitecore.ContentTesting" />
      <request name="ContentTesting.PersonalizationGallery.CanExecute" type="Sitecore.ContentTesting.Requests.ExperienceEditor.PersonalizationGalleryState, Sitecore.ContentTesting" />
      <request name="OptimizationView.Toogle.GetUrl" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ToogleOptimizationViewRequest, Sitecore.ContentTesting" />
      <request name="Optimization.GetTestSummaryTestId" type="Sitecore.ContentTesting.Requests.ExperienceEditor.TestSummaryRequest, Sitecore.ContentTesting" />
      <request name="Optimization.GetTestSummaryDetails" type="Sitecore.ContentTesting.Requests.ExperienceEditor.GetTestSummaryDetailsRequest, Sitecore.ContentTesting" />
      <request name="Optimization.ShowSuggestedPersonalization" type="Sitecore.ContentTesting.Requests.ExperienceEditor.ShowSuggestedPersonalizationDialogRequest, Sitecore.ContentTesting" />
      <!-- Delete -->
      <request name="ExperienceEditor.Delete.CheckActiveTestsRequest" type="Sitecore.ContentTesting.Requests.ExperienceEditor.Delete.CheckActiveTestsRequest, Sitecore.ContentTesting" />
      <request name="ExperienceEditor.Delete.DeleteActiveTestsRequest" type="Sitecore.ContentTesting.Requests.ExperienceEditor.Delete.DeleteActiveTestsRequest, Sitecore.ContentTesting" />
      <!-- Delete -->
    </sitecore.experienceeditor.speak.requests>

    <mvc>
      <precompilation>
        <assemblies>
          <assemblyIdentity name="Sitecore.ContentTesting" />
        </assemblies>
      </precompilation>
    </mvc>

  </sitecore>
</configuration>